<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í†µí•© í¸ì§‘ - Data Hub</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 240px;
            height: 100vh;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
            color: #ecf0f1;
            overflow-y: auto;
            z-index: 100;
        }
        .sidebar-header { padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); text-align: center; }
        .sidebar-header h2 { font-size: 18px; color: #fff; margin-bottom: 5px; }
        .sidebar-header p { font-size: 12px; color: #bdc3c7; }
        .menu-group { padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .menu-label { padding: 10px 20px; font-size: 11px; color: #95a5a6; text-transform: uppercase; }
        .menu-item { display: block; padding: 12px 20px; color: #ecf0f1; text-decoration: none; transition: all 0.3s; border-left: 3px solid transparent; }
        .menu-item:hover, .menu-item.active { background: rgba(255,255,255,0.1); border-left-color: #667eea; }
        
        .container { margin-left: 240px; padding: 20px; }
        h1 { color: white; margin-bottom: 20px; }
        
        .filters { background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 10px; }
        select, input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #667eea; color: white; }
        .btn-success { background: #48bb78; color: white; }
        .btn-danger { background: #f56565; color: white; }
        
        table { width: 100%; background: white; border-radius: 8px; overflow: hidden; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f7fafc; font-weight: 600; }
        .status { padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .status-pending { background: #fed7d7; color: #c53030; }
        .status-edited { background: #feebc8; color: #c05621; }
        .status-approved { background: #c6f6d5; color: #22543d; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 1000; }
        .modal.show { display: flex; }
        .modal-content { background: white; padding: 0; border-radius: 12px; width: 90%; max-width: 800px; max-height: 85vh; overflow: hidden; display: flex; flex-direction: column; }
        
        .modal-header { padding: 20px 30px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { margin: 0; color: #333; }
        .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #999; }
        
        .tabs { display: flex; border-bottom: 1px solid #eee; background: #f7fafc; }
        .tab { padding: 15px 25px; cursor: pointer; border: none; background: none; font-size: 14px; color: #666; transition: all 0.2s; }
        .tab.active { background: white; color: #667eea; border-bottom: 2px solid #667eea; font-weight: 600; }
        .tab:hover { background: #e2e8f0; }
        
        .modal-body { padding: 30px; overflow-y: auto; flex: 1; }
        .modal-footer { padding: 20px 30px; border-top: 1px solid #eee; display: flex; gap: 10px; justify-content: flex-end; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 14px; }
        .form-group label .required { color: #f56565; }
        .form-group input, .form-group select, .form-group textarea { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 6px; 
            font-size: 14px;
        }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-group small { color: #999; font-size: 12px; }
        
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        .menu-item, .hour-item { 
            background: #f7fafc; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 15px;
            position: relative;
        }
        .menu-item .remove-btn { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            background: #f56565; 
            color: white; 
            border: none; 
            width: 24px; 
            height: 24px; 
            border-radius: 50%; 
            cursor: pointer;
            font-size: 14px;
        }
        .add-btn { 
            background: #48bb78; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 14px;
        }
        .add-btn:hover { background: #38a169; }
        
        .checkbox-group { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .checkbox-label { display: flex; align-items: center; gap: 8px; padding: 10px; background: #f7fafc; border-radius: 6px; cursor: pointer; }
        .checkbox-label input { cursor: pointer; }
        .checkbox-label:hover { background: #e2e8f0; }
        
        .platform-badge { 
            display: inline-block; 
            padding: 4px 12px; 
            border-radius: 12px; 
            font-size: 12px; 
            font-weight: 600;
        }
        .platform-naver { background: #06BE34; color: white; }
        .platform-google { background: #4285F4; color: white; }
        .platform-manual { background: #9ca3af; color: white; }
        
        .image-list { display: flex; flex-direction: column; gap: 10px; }
        .image-item { display: flex; gap: 10px; align-items: center; }
        .image-item input { flex: 1; }
        .image-item button { width: 80px; }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>í•œì‹ë‹¹ Data Hub</h2>
            <p>Restaurant Data Collection</p>
        </div>
        <div class="menu-group">
            <div class="menu-label">ëŒ€ì‹œë³´ë“œ</div>
            <a href="/dashboard" class="menu-item">ğŸ“Š ë©”ì¸ ëŒ€ì‹œë³´ë“œ</a>
        </div>
        <div class="menu-group">
            <div class="menu-label">ë°ì´í„° ìˆ˜ì§‘</div>
            <a href="/dashboard/collection-request" class="menu-item">ğŸ“ ìˆ˜ì§‘ ìš”ì²­</a>
            <a href="/dashboard/collection-results" class="menu-item">ğŸ“‹ ìˆ˜ì§‘ ê²°ê³¼</a>
        </div>
        <div class="menu-group">
            <div class="menu-label">ë°ì´í„° ì…ë ¥</div>
            <a href="/dashboard/manual-input#url" class="menu-item">ğŸ”— URL ì…ë ¥</a>
            <a href="/dashboard/manual-input#csv" class="menu-item">ğŸ“„ CSV ì—…ë¡œë“œ</a>
            <a href="/dashboard/manual-input#direct" class="menu-item">âœï¸ ì§ì ‘ ì…ë ¥</a>
        </div>
        <div class="menu-group">
            <div class="menu-label">ë°ì´í„° í¸ì§‘</div>
            <a href="/dashboard/unified-editor" class="menu-item active">ğŸ”§ í†µí•© í¸ì§‘</a>
        </div>
        <div class="menu-group">
            <div class="menu-label">ë°°í¬ ê´€ë¦¬</div>
            <a href="/dashboard/deployment" class="menu-item">ğŸš€ ë°°í¬ ê´€ë¦¬</a>
        </div>
    </div>

    <div id="app" class="container">
        <h1>ğŸ¯ í†µí•© í¸ì§‘ & ë³‘í•©</h1>
        
        <div class="filters">
            <select v-model="filters.source" @change="loadRestaurants">
                <option value="">ëª¨ë“  ì†ŒìŠ¤</option>
                <option value="manual">ìˆ˜ë™ ì…ë ¥</option>
                <option value="naver">ë„¤ì´ë²„</option>
                <option value="google">êµ¬ê¸€</option>
            </select>
            <select v-model="filters.status" @change="loadRestaurants">
                <option value="">ëª¨ë“  ìƒíƒœ</option>
                <option value="pending">ëŒ€ê¸°</option>
                <option value="edited">í¸ì§‘ë¨</option>
                <option value="approved">ìŠ¹ì¸ë¨</option>
            </select>
            <button @click="loadRestaurants" class="btn-primary">ìƒˆë¡œê³ ì¹¨</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>ì´ë¦„</th>
                    <th>ì¹´í…Œê³ ë¦¬</th>
                    <th>í‰ì </th>
                    <th>ì¸ê¸°ì ìˆ˜</th>
                    <th>ì†ŒìŠ¤</th>
                    <th>ìƒíƒœ</th>
                    <th>ì‘ì—…</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="r in restaurants" :key="r.id">
                    <td>{{ r.name }}</td>
                    <td>{{ r.category || '-' }}</td>
                    <td>{{ r.rating || '-' }}</td>
                    <td>{{ r.popularity_score }}</td>
                    <td>
                        <span class="platform-badge" :class="'platform-' + r.source">{{ r.source }}</span>
                    </td>
                    <td><span :class="'status status-' + r.edit_status">{{ r.edit_status }}</span></td>
                    <td>
                        <button @click="openEdit(r)" class="btn-primary">í¸ì§‘</button>
                        <button @click="changeStatus(r.id, 'approved')" class="btn-success">ìŠ¹ì¸</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="modal" :class="{show: showEditModal}">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ë ˆìŠ¤í† ë‘ í¸ì§‘</h2>
                    <button class="close-btn" @click="closeModal">&times;</button>
                </div>
                
                <div class="tabs">
                    <button class="tab" :class="{active: activeTab === 'basic'}" @click="activeTab = 'basic'">ê¸°ë³¸ì •ë³´</button>
                    <button class="tab" :class="{active: activeTab === 'details'}" @click="activeTab = 'details'">ìƒì„¸ì •ë³´</button>
                    <button class="tab" :class="{active: activeTab === 'menu'}" @click="activeTab = 'menu'">ë©”ë‰´</button>
                    <button class="tab" :class="{active: activeTab === 'hours'}" @click="activeTab = 'hours'">ì˜ì—…ì‹œê°„</button>
                    <button class="tab" :class="{active: activeTab === 'links'}" @click="activeTab = 'links'">ë§í¬/ì‹œì„¤</button>
                </div>
                
                <div class="modal-body" v-if="editingRestaurant">
                    <div v-show="activeTab === 'basic'">
                        <div class="form-group">
                            <label>ì´ë¦„ <span class="required">*</span></label>
                            <input v-model="editingRestaurant.name" placeholder="ë ˆìŠ¤í† ë‘ ì´ë¦„">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>ì¹´í…Œê³ ë¦¬ <span class="required">*</span></label>
                                <select v-model="editingRestaurant.category">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="í•œì‹">í•œì‹</option>
                                    <option value="ì¤‘ì‹">ì¤‘ì‹</option>
                                    <option value="ì¼ì‹">ì¼ì‹</option>
                                    <option value="ì–‘ì‹">ì–‘ì‹</option>
                                    <option value="ì¹´í˜/ë””ì €íŠ¸">ì¹´í˜/ë””ì €íŠ¸</option>
                                    <option value="í•´ì‚°ë¬¼">í•´ì‚°ë¬¼</option>
                                    <option value="ê³ ê¸°/êµ¬ì´">ê³ ê¸°/êµ¬ì´</option>
                                    <option value="ë¶„ì‹">ë¶„ì‹</option>
                                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>ê°€ê²©ëŒ€</label>
                                <select v-model="editingRestaurant.price_range">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="ì €ê°€">ì €ê°€ (1ë§Œì› ì´í•˜)</option>
                                    <option value="ì¤‘ê°€">ì¤‘ê°€ (1-3ë§Œì›)</option>
                                    <option value="ê³ ê°€">ê³ ê°€ (3ë§Œì› ì´ìƒ)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>ì£¼ì†Œ <span class="required">*</span></label>
                            <input v-model="editingRestaurant.address" placeholder="ì „ì²´ ì£¼ì†Œ">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>ì „í™”ë²ˆí˜¸</label>
                                <input v-model="editingRestaurant.phone" placeholder="02-1234-5678">
                            </div>
                            
                            <div class="form-group">
                                <label>ì§€ì—­</label>
                                <input v-model="editingRestaurant.region" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>í‰ì  (1-5)</label>
                                <input v-model.number="editingRestaurant.rating" type="number" step="0.1" min="0" max="5">
                            </div>
                            
                            <div class="form-group">
                                <label>ë¦¬ë·° ìˆ˜</label>
                                <input v-model.number="editingRestaurant.review_count" type="number" min="0">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>ìœ„ë„</label>
                                <input v-model.number="editingRestaurant.latitude" type="number" step="0.000001">
                            </div>
                            
                            <div class="form-group">
                                <label>ê²½ë„</label>
                                <input v-model.number="editingRestaurant.longitude" type="number" step="0.000001">
                            </div>
                        </div>
                    </div>
                    
                    <div v-show="activeTab === 'details'">
                        <div class="form-group">
                            <label>ì„¤ëª…</label>
                            <textarea v-model="editingRestaurant.description" placeholder="ë ˆìŠ¤í† ë‘ ì„¤ëª… (ìµœëŒ€ 500ì)"></textarea>
                            <small>{{ (editingRestaurant.description || '').length }} / 500ì</small>
                        </div>
                        
                        <div class="form-group">
                            <label>ì¸ë„¤ì¼ URL</label>
                            <input v-model="editingRestaurant.thumbnail_url" placeholder="https://example.com/image.jpg">
                        </div>
                        
                        <div class="form-group">
                            <label>ì´ë¯¸ì§€ URL ëª©ë¡</label>
                            <div class="image-list">
                                <div class="image-item" v-for="(img, idx) in editingRestaurant.images" :key="idx">
                                    <input v-model="editingRestaurant.images[idx]" :placeholder="'ì´ë¯¸ì§€ ' + (idx + 1)">
                                    <button class="btn-danger" @click="removeImage(idx)">ì‚­ì œ</button>
                                </div>
                                <button class="add-btn" @click="addImage" v-if="editingRestaurant.images.length < 10">â• ì´ë¯¸ì§€ ì¶”ê°€</button>
                            </div>
                            <small>ìµœëŒ€ 10ê°œ</small>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>YouTube ì–¸ê¸‰ ìˆ˜</label>
                                <input v-model.number="editingRestaurant.youtube_mention_count" type="number" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label>ë¸”ë¡œê·¸ ì–¸ê¸‰ ìˆ˜</label>
                                <input v-model.number="editingRestaurant.blog_mention_count" type="number" min="0">
                            </div>
                        </div>
                    </div>
                    
                    <div v-show="activeTab === 'menu'">
                        <div class="form-group">
                            <label>ë©”ë‰´ ëª©ë¡</label>
                            <div v-if="editingRestaurant.menu_items && editingRestaurant.menu_items.length > 0">
                                <div class="menu-item" v-for="(menu, idx) in editingRestaurant.menu_items" :key="idx">
                                    <button class="remove-btn" @click="removeMenu(idx)">Ã—</button>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>ë©”ë‰´ëª…</label>
                                            <input v-model="menu.name" placeholder="ì˜ˆ: ê¹€ì¹˜ì°Œê°œ">
                                        </div>
                                        <div class="form-group">
                                            <label>ê°€ê²© (ì›)</label>
                                            <input v-model.number="menu.price" type="number" placeholder="8000">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>ì„¤ëª… (ì„ íƒ)</label>
                                        <input v-model="menu.description" placeholder="ë©”ë‰´ ì„¤ëª…">
                                    </div>
                                </div>
                            </div>
                            <button class="add-btn" @click="addMenu">â• ë©”ë‰´ ì¶”ê°€</button>
                            <small v-if="!editingRestaurant.menu_items || editingRestaurant.menu_items.length === 0">ë©”ë‰´ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”</small>
                        </div>
                    </div>
                    
                    <div v-show="activeTab === 'hours'">
                        <div class="form-group">
                            <label>ì˜ì—…ì‹œê°„</label>
                            <div class="hour-item" v-for="day in weekDays" :key="day.value">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>{{ day.label }}</label>
                                        <div style="display: flex; gap: 10px; align-items: center;">
                                            <input 
                                                v-model="getHours(day.value).open" 
                                                type="time" 
                                                style="flex: 1;"
                                                :disabled="getHours(day.value).closed"
                                            >
                                            <span>~</span>
                                            <input 
                                                v-model="getHours(day.value).close" 
                                                type="time" 
                                                style="flex: 1;"
                                                :disabled="getHours(day.value).closed"
                                            >
                                            <label style="margin: 0; display: flex; align-items: center; gap: 5px;">
                                                <input 
                                                    type="checkbox" 
                                                    v-model="getHours(day.value).closed"
                                                    @change="toggleClosed(day.value)"
                                                >
                                                íœ´ë¬´
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button class="add-btn" @click="applyToAll" style="margin-top: 15px;">ì›”ìš”ì¼ ì‹œê°„ì„ ì „ì²´ ì ìš©</button>
                        </div>
                    </div>
                    
                    <div v-show="activeTab === 'links'">
                        <div class="form-group">
                            <label>í”Œë«í¼</label>
                            <select v-model="editingRestaurant.source">
                                <option value="manual">ìˆ˜ë™ ì…ë ¥</option>
                                <option value="naver">ë„¤ì´ë²„</option>
                                <option value="google">êµ¬ê¸€</option>
                            </select>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Google Place ID</label>
                                <input v-model="editingRestaurant.google_place_id" placeholder="ChIJ...">
                            </div>
                            
                            <div class="form-group">
                                <label>Naver Place ID</label>
                                <input v-model="editingRestaurant.naver_place_id" placeholder="1234567">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Google Maps URL</label>
                                <input v-model="editingRestaurant.google_maps_url" placeholder="https://maps.google.com/...">
                            </div>
                            
                            <div class="form-group">
                                <label>Naver Map URL</label>
                                <input v-model="editingRestaurant.naver_map_url" placeholder="https://map.naver.com/...">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>ì›ë³¸ URL</label>
                            <input v-model="editingRestaurant.source_url" placeholder="ì›ë³¸ í˜ì´ì§€ URL">
                        </div>
                        
                        <div class="form-group">
                            <label>í¸ì˜ì‹œì„¤</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" v-model="facilities.parking"> ğŸ…¿ï¸ ì£¼ì°¨
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" v-model="facilities.wifi"> ğŸ“¶ WiFi
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" v-model="facilities.reservation"> ğŸ“ ì˜ˆì•½
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" v-model="facilities.delivery"> ğŸ›µ ë°°ë‹¬
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" v-model="facilities.takeout"> ğŸ“¦ í¬ì¥
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" v-model="facilities.group"> ğŸ‘¥ ë‹¨ì²´ì„
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" v-model="facilities.kids"> ğŸ‘¶ ìœ ì•„ë™ë°˜
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" v-model="facilities.wheelchair"> â™¿ íœ ì²´ì–´
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" v-model="facilities.pet"> ğŸ• ë°˜ë ¤ë™ë¬¼
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button @click="saveEdit" class="btn-success">ğŸ’¾ ì €ì¥</button>
                    <button @click="closeModal" class="btn-danger">âœ• ì·¨ì†Œ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    restaurants: [],
                    filters: { source: '', status: '' },
                    showEditModal: false,
                    editingRestaurant: null,
                    activeTab: 'basic',
                    weekDays: [
                        { value: 'monday', label: 'ì›”ìš”ì¼' },
                        { value: 'tuesday', label: 'í™”ìš”ì¼' },
                        { value: 'wednesday', label: 'ìˆ˜ìš”ì¼' },
                        { value: 'thursday', label: 'ëª©ìš”ì¼' },
                        { value: 'friday', label: 'ê¸ˆìš”ì¼' },
                        { value: 'saturday', label: 'í† ìš”ì¼' },
                        { value: 'sunday', label: 'ì¼ìš”ì¼' }
                    ],
                    facilities: {
                        parking: false,
                        wifi: false,
                        reservation: false,
                        delivery: false,
                        takeout: false,
                        group: false,
                        kids: false,
                        wheelchair: false,
                        pet: false
                    }
                }
            },
            mounted() {
                this.loadRestaurants();
            },
            methods: {
                async loadRestaurants() {
                    try {
                        const params = new URLSearchParams();
                        if (this.filters.source) params.append('source', this.filters.source);
                        if (this.filters.status) params.append('edit_status', this.filters.status);
                        const res = await axios.get(`/api/data-management/collection-results?${params}`);
                        this.restaurants = res.data.data || [];
                    } catch (error) {
                        console.error('ë¡œë“œ ì‹¤íŒ¨:', error);
                        alert('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                    }
                },
                
                async openEdit(r) {
                    try {
                        const res = await axios.get(`/api/data-management/collection-results/${r.id}`);
                        const data = res.data.data;
                        
                        this.editingRestaurant = {
                            id: data.id,
                            name: data.name || '',
                            category: data.category || '',
                            address: data.address || '',
                            phone: data.phone || '',
                            region: data.region || '',
                            rating: data.rating || 0,
                            review_count: data.review_count || 0,
                            price_range: data.price_range || '',
                            description: data.description || '',
                            latitude: data.latitude || null,
                            longitude: data.longitude || null,
                            thumbnail_url: data.thumbnail_url || '',
                            images: data.images || [],
                            menu_items: data.menu_items || [],
                            business_hours: data.business_hours || {},
                            source: data.source || 'manual',
                            google_place_id: data.google_place_id || '',
                            naver_place_id: data.naver_place_id || '',
                            google_maps_url: data.google_maps_url || '',
                            naver_map_url: data.naver_map_url || '',
                            source_url: data.source_url || '',
                            youtube_mention_count: data.youtube_mention_count || 0,
                            blog_mention_count: data.blog_mention_count || 0,
                            facilities: data.facilities || {}
                        };
                        
                        this.facilities = {
                            parking: data.facilities?.parking || false,
                            wifi: data.facilities?.wifi || false,
                            reservation: data.facilities?.reservation || false,
                            delivery: data.facilities?.delivery || false,
                            takeout: data.facilities?.takeout || false,
                            group: data.facilities?.group || false,
                            kids: data.facilities?.kids || false,
                            wheelchair: data.facilities?.wheelchair || false,
                            pet: data.facilities?.pet || false
                        };
                        
                        if (!this.editingRestaurant.business_hours || Object.keys(this.editingRestaurant.business_hours).length === 0) {
                            this.editingRestaurant.business_hours = {};
                            this.weekDays.forEach(day => {
                                this.editingRestaurant.business_hours[day.value] = {
                                    open: '10:00',
                                    close: '22:00',
                                    closed: false
                                };
                            });
                        }
                        
                        if (!Array.isArray(this.editingRestaurant.images)) {
                            this.editingRestaurant.images = [];
                        }
                        
                        this.showEditModal = true;
                        this.activeTab = 'basic';
                    } catch (error) {
                        console.error('ìƒì„¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                        alert('ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨');
                    }
                },
                
                closeModal() {
                    this.showEditModal = false;
                    this.editingRestaurant = null;
                    this.activeTab = 'basic';
                },
                
                async saveEdit() {
                    try {
                        const id = this.editingRestaurant.id;
                        this.editingRestaurant.facilities = { ...this.facilities };
                        
                        await axios.put(`/api/data-management/collection-results/${id}`, this.editingRestaurant);
                        
                        this.closeModal();
                        await this.loadRestaurants();
                        alert('âœ… ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
                    } catch (error) {
                        console.error('ì €ì¥ ì‹¤íŒ¨:', error);
                        alert('âŒ ì €ì¥ ì‹¤íŒ¨: ' + (error.response?.data?.detail || error.message));
                    }
                },
                
                async changeStatus(id, status) {
                    try {
                        await axios.put(`/api/data-management/collection-results/${id}`, { edit_status: status });
                        await this.loadRestaurants();
                        alert('ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
                    } catch (error) {
                        console.error('ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨:', error);
                        alert('ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨');
                    }
                },
                
                addMenu() {
                    if (!this.editingRestaurant.menu_items) {
                        this.editingRestaurant.menu_items = [];
                    }
                    this.editingRestaurant.menu_items.push({
                        name: '',
                        price: 0,
                        description: ''
                    });
                },
                
                removeMenu(index) {
                    this.editingRestaurant.menu_items.splice(index, 1);
                },
                
                addImage() {
                    if (!this.editingRestaurant.images) {
                        this.editingRestaurant.images = [];
                    }
                    if (this.editingRestaurant.images.length < 10) {
                        this.editingRestaurant.images.push('');
                    }
                },
                
                removeImage(index) {
                    this.editingRestaurant.images.splice(index, 1);
                },
                
                getHours(day) {
                    if (!this.editingRestaurant.business_hours) {
                        this.editingRestaurant.business_hours = {};
                    }
                    if (!this.editingRestaurant.business_hours[day]) {
                        this.editingRestaurant.business_hours[day] = {
                            open: '10:00',
                            close: '22:00',
                            closed: false
                        };
                    }
                    return this.editingRestaurant.business_hours[day];
                },
                
                toggleClosed(day) {
                    const hours = this.getHours(day);
                    if (hours.closed) {
                        hours.open = '';
                        hours.close = '';
                    } else {
                        hours.open = '10:00';
                        hours.close = '22:00';
                    }
                },
                
                applyToAll() {
                    const mondayHours = this.getHours('monday');
                    this.weekDays.forEach(day => {
                        if (day.value !== 'monday') {
                            this.editingRestaurant.business_hours[day.value] = {
                                open: mondayHours.open,
                                close: mondayHours.close,
                                closed: mondayHours.closed
                            };
                        }
                    });
                    alert('âœ… ì›”ìš”ì¼ ì‹œê°„ì´ ì „ì²´ì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
