<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ˜ì§‘ ê²°ê³¼ - í•œì‹ë‹¹ Data Hub</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 240px;
            height: 100vh;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
            color: #ecf0f1;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        .sidebar-header h2 {
            margin: 0 0 5px 0;
            font-size: 18px;
            color: #fff;
        }

        .sidebar-header p {
            margin: 0;
            font-size: 12px;
            color: #bdc3c7;
        }

        .menu-group {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .menu-label {
            padding: 10px 20px;
            font-size: 11px;
            font-weight: 600;
            color: #95a5a6;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .menu-item {
            display: block;
            padding: 12px 20px;
            color: #ecf0f1;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 14px;
            border-left: 3px solid transparent;
        }

        .menu-item:hover {
            background: rgba(255,255,255,0.1);
            border-left-color: #3498db;
            padding-left: 25px;
        }

        .menu-item.active {
            background: rgba(52, 152, 219, 0.2);
            border-left-color: #3498db;
            font-weight: 600;
        }

        .menu-item.submenu {
            padding-left: 40px;
            font-size: 13px;
        }

        .menu-item.submenu:hover {
            padding-left: 45px;
        }

        .main-content {
            margin-left: 260px;
            min-height: 100vh;
            padding: 30px;
        }

        .header {
            background: white;
            padding: 25px 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2rem;
            color: #2c3e50;
            margin: 0 0 5px 0;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 0.95rem;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .stats-bar {
            display: flex;
            gap: 20px;
            padding: 15px 0;
            border-top: 1px solid #ecf0f1;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .stat-label {
            color: #7f8c8d;
        }

        .stat-value {
            font-weight: 700;
            color: #2c3e50;
            font-size: 16px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .filter-group {
            flex: 1;
        }

        .filter-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 6px;
        }

        .filter-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ecf0f1;
            border-radius: 6px;
            font-size: 14px;
        }

        .filter-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .spreadsheet-wrapper {
            overflow-x: auto;
            overflow-y: auto;
            max-height: calc(100vh - 400px);
        }

        .spreadsheet {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .spreadsheet thead {
            position: sticky;
            top: 0;
            z-index: 10;
            background: #f8f9fa;
        }

        .spreadsheet th {
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #e9ecef;
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
        }

        .spreadsheet th:hover {
            background: #e9ecef;
        }

        .spreadsheet td {
            padding: 10px;
            border-bottom: 1px solid #f1f3f5;
            vertical-align: middle;
        }

        .spreadsheet tbody tr {
            transition: background 0.2s ease;
        }

        .spreadsheet tbody tr:hover {
            background: #f8f9fa;
        }

        .spreadsheet tbody tr.selected {
            background: #e7f3ff;
        }

        .cell-editable {
            cursor: text;
            position: relative;
        }

        .cell-editable:hover {
            background: #fff9e6;
        }

        .cell-input {
            width: 100%;
            padding: 8px;
            border: 2px solid #667eea;
            border-radius: 4px;
            font-size: 13px;
            font-family: inherit;
        }

        .score-cell {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .score-bar {
            flex: 1;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .score-fill.top_rated {
            background: linear-gradient(90deg, #f39c12 0%, #e74c3c 100%);
        }

        .score-fill.popular {
            background: linear-gradient(90deg, #3498db 0%, #2980b9 100%);
        }

        .score-fill.average {
            background: linear-gradient(90deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .score-fill.new {
            background: linear-gradient(90deg, #bdc3c7 0%, #95a5a6 100%);
        }

        .score-text {
            font-weight: 700;
            min-width: 35px;
            text-align: right;
        }

        .tier-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .tier-badge.top_rated {
            background: #fee;
            color: #e74c3c;
        }

        .tier-badge.popular {
            background: #e3f2fd;
            color: #2196f3;
        }

        .tier-badge.average {
            background: #f5f5f5;
            color: #757575;
        }

        .tier-badge.new {
            background: #e8f5e9;
            color: #4caf50;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-badge.pending {
            background: #fff3e0;
            color: #f57c00;
        }

        .status-badge.edited {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status-badge.approved {
            background: #e8f5e9;
            color: #388e3c;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .action-cell {
            display: flex;
            gap: 5px;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            transition: background 0.2s;
            font-size: 16px;
        }

        .icon-btn:hover {
            background: #f1f3f5;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .spinner {
            border: 3px solid #ecf0f1;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 40px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .bulk-actions {
            background: #fff9e6;
            padding: 15px 20px;
            border-bottom: 1px solid #ffd54f;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bulk-actions-text {
            font-size: 14px;
            color: #2c3e50;
            font-weight: 600;
        }

        .detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .detail-modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }

        .modal-body {
            padding: 20px;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-section h3 {
            font-size: 14px;
            color: #667eea;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .detail-row {
            display: flex;
            margin-bottom: 8px;
        }

        .detail-label {
            font-weight: 600;
            min-width: 100px;
            color: #666;
        }

        .detail-value {
            flex: 1;
            color: #333;
        }

        .link-btn {
            display: inline-block;
            padding: 6px 12px;
            background: #667eea;
            color: white;
            border-radius: 4px;
            text-decoration: none;
            margin-right: 8px;
            font-size: 13px;
        }

        .menu-item-box {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>í•œì‹ë‹¹ Data Hub</h2>
                <p>Restaurant Data Collection</p>
            </div>

            <div class="menu-group">
                <div class="menu-label">ëŒ€ì‹œë³´ë“œ</div>
                <a href="/dashboard" class="menu-item">ğŸ“Š ë©”ì¸ ëŒ€ì‹œë³´ë“œ</a>
            </div>

            <div class="menu-group">
                <div class="menu-label">ë°ì´í„° ìˆ˜ì§‘</div>
                <a href="/dashboard/collection-request" class="menu-item">ğŸ“ ìˆ˜ì§‘ ìš”ì²­</a>
                <a href="/dashboard/collection-results" class="menu-item active">ğŸ“‹ ìˆ˜ì§‘ ê²°ê³¼</a>
            </div>

            <div class="menu-group">
                <div class="menu-label">ë°ì´í„° ì…ë ¥</div>
                <a href="/dashboard/manual-input#url" class="menu-item">ğŸ”— URL ì…ë ¥</a>
                <a href="/dashboard/manual-input#csv" class="menu-item">ğŸ“„ CSV ì—…ë¡œë“œ</a>
                <a href="/dashboard/manual-input#direct" class="menu-item">âœï¸ ì§ì ‘ ì…ë ¥</a>
            </div>

            <div class="menu-group">
                <div class="menu-label">ë°ì´í„° í¸ì§‘</div>
                <a href="/dashboard/unified-editor" class="menu-item">ğŸ”§ í†µí•© í¸ì§‘</a>
            </div>

            <div class="menu-group">
                <div class="menu-label">ë°°í¬ ê´€ë¦¬</div>
                <a href="/dashboard/deployment" class="menu-item">ğŸš€ ë°°í¬ ê´€ë¦¬</a>
            </div>
        </div>

        <div class="main-content">
            <div class="header">
                <div class="header-top">
                    <div>
                        <h1>ğŸ“‹ ìˆ˜ì§‘ ê²°ê³¼</h1>
                        <p class="subtitle">ìˆ˜ì§‘ëœ ë ˆìŠ¤í† ë‘ ë°ì´í„°ë¥¼ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ í˜•ì‹ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  í¸ì§‘í•©ë‹ˆë‹¤</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" @click="refreshData">
                            ğŸ”„ ìƒˆë¡œê³ ì¹¨
                        </button>
                        <button class="btn btn-primary" @click="exportCSV">
                            ğŸ“¥ CSV ë‚´ë³´ë‚´ê¸°
                        </button>
                    </div>
                </div>

                <div class="stats-bar">
                    <div class="stat-item">
                        <span class="stat-label">ì „ì²´:</span>
                        <span class="stat-value">{{ stats.total }}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">í‰ê·  ì ìˆ˜:</span>
                        <span class="stat-value">{{ stats.avg_score }}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Top Rated:</span>
                        <span class="stat-value">{{ stats.top_rated }}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Popular:</span>
                        <span class="stat-value">{{ stats.popular }}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ê²€ì¦ë¨:</span>
                        <span class="stat-value">{{ stats.validated }}</span>
                    </div>
                </div>
            </div>

            <div class="filters">
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">í¸ì§‘ ìƒíƒœ</label>
                        <select class="filter-input" v-model="filters.edit_status" @change="applyFilters">
                            <option value="">ì „ì²´</option>
                            <option value="pending">ëŒ€ê¸°ì¤‘</option>
                            <option value="edited">í¸ì§‘ë¨</option>
                            <option value="approved">ìŠ¹ì¸ë¨</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">ì¶œì²˜</label>
                        <select class="filter-input" v-model="filters.source" @change="applyFilters">
                            <option value="">ì „ì²´</option>
                            <option value="naver">ë„¤ì´ë²„</option>
                            <option value="google">êµ¬ê¸€</option>
                            <option value="kakao">ì¹´ì¹´ì˜¤</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">ìµœì†Œ ì ìˆ˜</label>
                        <input type="number" class="filter-input" v-model.number="filters.min_score" @input="applyFilters" placeholder="0-100">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">ê²€ìƒ‰</label>
                        <input type="text" class="filter-input" v-model="searchQuery" @input="applySearch" placeholder="ì´ë¦„ ë˜ëŠ” ì£¼ì†Œ ê²€ìƒ‰">
                    </div>
                    <button class="btn btn-secondary" @click="clearFilters">ì´ˆê¸°í™”</button>
                </div>
            </div>

            <div class="table-container">
                <div v-if="selectedRows.length > 0" class="bulk-actions">
                    <span class="bulk-actions-text">{{ selectedRows.length }}ê°œ ì„ íƒë¨</span>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success btn-small" @click="bulkRecalculate">ì ìˆ˜ ì¬ê³„ì‚°</button>
                        <button class="btn btn-secondary btn-small" @click="bulkDelete">ì‚­ì œ</button>
                    </div>
                </div>

                <div v-if="loading" class="spinner"></div>

                <div v-else-if="filteredResults.length === 0" class="empty-state">
                    <div class="empty-state-icon">ğŸ“­</div>
                    <div style="font-size: 18px; font-weight: 600; color: #2c3e50; margin-bottom: 10px;">
                        ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤
                    </div>
                    <div>í•„í„°ë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ìˆ˜ì§‘ ìš”ì²­ì„ ìƒì„±í•˜ì„¸ìš”</div>
                </div>

                <div v-else class="spreadsheet-wrapper">
                    <table class="spreadsheet">
                        <thead>
                            <tr>
                                <th style="width: 40px;">
                                    <input type="checkbox" class="checkbox" v-model="selectAll" @change="toggleSelectAll">
                                </th>
                                <th @click="sortBy('name')">ì´ë¦„ {{ getSortIcon('name') }}</th>
                                <th @click="sortBy('category')">ë¶„ë¥˜ {{ getSortIcon('category') }}</th>
                                <th @click="sortBy('address')">ì£¼ì†Œ {{ getSortIcon('address') }}</th>
                                <th @click="sortBy('phone')">ì „í™”ë²ˆí˜¸ {{ getSortIcon('phone') }}</th>
                                <th @click="sortBy('rating')">í‰ì  {{ getSortIcon('rating') }}</th>
                                <th @click="sortBy('review_count')">ë¦¬ë·°ìˆ˜ {{ getSortIcon('review_count') }}</th>
                                <th @click="sortBy('popularity_score')">ì¸ê¸°ë„ {{ getSortIcon('popularity_score') }}</th>
                                <th>í‹°ì–´</th>
                                <th>ì¶œì²˜</th>
                                <th>ìƒíƒœ</th>
                                <th style="width: 100px;">ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="item in filteredResults" :key="item.id" :class="{ selected: isSelected(item.id) }">
                                <td>
                                    <input type="checkbox" class="checkbox" :checked="isSelected(item.id)" @change="toggleSelect(item.id)">
                                </td>
                                <td>
                                    <strong>{{ item.name }}</strong>
                                </td>
                                <td>{{ item.category || '-' }}</td>
                                <td>{{ item.address || '-' }}</td>
                                <td>{{ item.phone || '-' }}</td>
                                <td>{{ item.rating ? item.rating.toFixed(1) : '-' }}</td>
                                <td>{{ item.review_count || 0 }}</td>
                                <td>
                                    <div class="score-cell">
                                        <div class="score-bar">
                                            <div class="score-fill" :class="item.popularity_tier" :style="{ width: item.popularity_score + '%' }"></div>
                                        </div>
                                        <span class="score-text">{{ item.popularity_score.toFixed(0) }}</span>
                                    </div>
                                </td>
                                <td>
                                    <span class="tier-badge" :class="item.popularity_tier">
                                        {{ getTierText(item.popularity_tier) }}
                                    </span>
                                </td>
                                <td>{{ item.source.toUpperCase() }}</td>
                                <td>
                                    <span class="status-badge" :class="item.edit_status">
                                        {{ getStatusText(item.edit_status) }}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-cell">
                                        <button class="icon-btn" @click="viewDetail(item.id)" title="ìƒì„¸ë³´ê¸°">ğŸ‘ï¸</button>
                                        <button class="icon-btn" @click="recalculateScore(item.id)" title="ì ìˆ˜ ì¬ê³„ì‚°">ğŸ”„</button>
                                        <button class="icon-btn" @click="deleteResult(item.id)" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
            <div class="detail-modal" :class="{show: showDetailModal}" @click.self="showDetailModal = false">
                <div class="modal-content" v-if="detailData">
                    <div class="modal-header">
                        <h2>{{ detailData.name }}</h2>
                        <button class="modal-close" @click="showDetailModal = false">Ã—</button>
                    </div>
                    <div class="modal-body">
                        <div class="detail-section">
                            <h3>ğŸ“ ê¸°ë³¸ ì •ë³´</h3>
                            <div class="detail-row">
                                <span class="detail-label">ì¹´í…Œê³ ë¦¬:</span>
                                <span class="detail-value">{{ detailData.category || '-' }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">ì£¼ì†Œ:</span>
                                <span class="detail-value">{{ detailData.address || '-' }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">ì „í™”:</span>
                                <span class="detail-value">{{ detailData.phone || '-' }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">í‰ì :</span>
                                <span class="detail-value">â­ {{ detailData.rating }} ({{ detailData.review_count }}ê°œ ë¦¬ë·°)</span>
                            </div>
                        </div>

                        <div class="detail-section" v-if="detailData.menu_items && detailData.menu_items.length">
                            <h3>ğŸ½ï¸ ë©”ë‰´</h3>
                            <div class="menu-item-box" v-for="menu in detailData.menu_items" :key="menu.name">
                                <strong>{{ menu.name }}</strong> - {{ menu.price || 'ê°€ê²© ë¯¸ì •' }}
                                <div v-if="menu.description" style="font-size: 12px; color: #666; margin-top: 4px;">
                                    {{ menu.description }}
                                </div>
                            </div>
                        </div>

                        <div class="detail-section" v-if="detailData.business_hours">
                            <h3>ğŸ• ì˜ì—…ì‹œê°„</h3>
                            <div class="detail-value">{{ formatBusinessHours(detailData.business_hours) }}</div>
                        </div>

                        <div class="detail-section" v-if="detailData.google_maps_url || detailData.naver_map_url">
                            <h3>ğŸ”— ë°”ë¡œê°€ê¸°</h3>
                            <a v-if="detailData.google_maps_url" :href="detailData.google_maps_url" target="_blank" class="link-btn">
                                Googleì—ì„œ ë³´ê¸°
                            </a>
                            <a v-if="detailData.naver_map_url" :href="detailData.naver_map_url" target="_blank" class="link-btn">
                                ë„¤ì´ë²„ì—ì„œ ë³´ê¸°
                            </a>
                        </div>

                        <div class="detail-section">
                            <h3>ğŸ“Š ì¸ê¸°ë„ ì ìˆ˜</h3>
                            <div class="detail-row">
                                <span class="detail-label">ì¢…í•© ì ìˆ˜:</span>
                                <span class="detail-value">{{ detailData.popularity_score }}/100</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">í‹°ì–´:</span>
                                <span class="detail-value">{{ getTierText(detailData.popularity_tier) }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    results: [],
                    filteredResults: [],
                    loading: false,
                    stats: {
                        total: 0,
                        avg_score: 0,
                        top_rated: 0,
                        popular: 0,
                        validated: 0
                    },
                    filters: {
                        edit_status: '',
                        source: '',
                        min_score: null
                    },
                    searchQuery: '',
                    sortKey: 'created_at',
                    sortOrder: 'desc',
                    selectedRows: [],
                    selectAll: false,
                    showDetailModal: false,
                    detailData: null
                };
            },
            mounted() {
                this.loadData();
                this.loadStats();
            },
            methods: {
                async loadData() {
                    this.loading = true;
                    try {
                        const params = new URLSearchParams();
                        if (this.filters.edit_status) params.append('edit_status', this.filters.edit_status);
                        if (this.filters.source) params.append('source', this.filters.source);
                        if (this.filters.min_score) params.append('min_score', this.filters.min_score);
                        params.append('limit', '100');

                        const response = await axios.get(`/api/data-management/collection-results?${params}`);
                        if (response.data.success) {
                            this.results = response.data.data;
                            this.applySearch();
                        }
                    } catch (error) {
                        console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                        alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    } finally {
                        this.loading = false;
                    }
                },
                async loadStats() {
                    try {
                        const response = await axios.get('/api/data-management/collection-results/stats/summary');
                        if (response.data.success) {
                            const data = response.data.data;
                            this.stats = {
                                total: data.total,
                                avg_score: data.avg_popularity_score,
                                top_rated: data.by_tier.top_rated,
                                popular: data.by_tier.popular,
                                validated: data.validated
                            };
                        }
                    } catch (error) {
                        console.error('í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
                    }
                },
                applyFilters() {
                    this.loadData();
                },
                applySearch() {
                    if (!this.searchQuery) {
                        this.filteredResults = [...this.results];
                    } else {
                        const query = this.searchQuery.toLowerCase();
                        this.filteredResults = this.results.filter(item => {
                            return (item.name && item.name.toLowerCase().includes(query)) ||
                                   (item.address && item.address.toLowerCase().includes(query));
                        });
                    }
                    this.applySort();
                },
                sortBy(key) {
                    if (this.sortKey === key) {
                        this.sortOrder = this.sortOrder === 'asc' ? 'desc' : 'asc';
                    } else {
                        this.sortKey = key;
                        this.sortOrder = 'desc';
                    }
                    this.applySort();
                },
                applySort() {
                    this.filteredResults.sort((a, b) => {
                        let aVal = a[this.sortKey];
                        let bVal = b[this.sortKey];

                        if (aVal === null || aVal === undefined) return 1;
                        if (bVal === null || bVal === undefined) return -1;

                        if (typeof aVal === 'string') {
                            aVal = aVal.toLowerCase();
                            bVal = bVal.toLowerCase();
                        }

                        if (this.sortOrder === 'asc') {
                            return aVal > bVal ? 1 : -1;
                        } else {
                            return aVal < bVal ? 1 : -1;
                        }
                    });
                },
                getSortIcon(key) {
                    if (this.sortKey !== key) return '';
                    return this.sortOrder === 'asc' ? 'â†‘' : 'â†“';
                },
                clearFilters() {
                    this.filters = {
                        edit_status: '',
                        source: '',
                        min_score: null
                    };
                    this.searchQuery = '';
                    this.loadData();
                },
                refreshData() {
                    this.loadData();
                    this.loadStats();
                },
                toggleSelect(id) {
                    const index = this.selectedRows.indexOf(id);
                    if (index > -1) {
                        this.selectedRows.splice(index, 1);
                    } else {
                        this.selectedRows.push(id);
                    }
                },
                toggleSelectAll() {
                    if (this.selectAll) {
                        this.selectedRows = this.filteredResults.map(r => r.id);
                    } else {
                        this.selectedRows = [];
                    }
                },
                isSelected(id) {
                    return this.selectedRows.includes(id);
                },
                async recalculateScore(id) {
                    try {
                        const response = await axios.post(`/api/data-management/collection-results/${id}/recalculate-score`);
                        if (response.data.success) {
                            alert('ì ìˆ˜ê°€ ì¬ê³„ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.');
                            this.loadData();
                            this.loadStats();
                        }
                    } catch (error) {
                        console.error('ì¬ê³„ì‚° ì‹¤íŒ¨:', error);
                        alert('ì¬ê³„ì‚°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                },
                async deleteResult(id) {
                    if (!confirm('ì´ ê²°ê³¼ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

                    try {
                        const response = await axios.delete(`/api/data-management/collection-results/${id}`);
                        if (response.data.success) {
                            alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                            this.loadData();
                            this.loadStats();
                        }
                    } catch (error) {
                        console.error('ì‚­ì œ ì‹¤íŒ¨:', error);
                        alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                },
                async bulkRecalculate() {
                    if (!confirm(`${this.selectedRows.length}ê°œ í•­ëª©ì˜ ì ìˆ˜ë¥¼ ì¬ê³„ì‚°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

                    let success = 0;
                    for (const id of this.selectedRows) {
                        try {
                            await axios.post(`/api/data-management/collection-results/${id}/recalculate-score`);
                            success++;
                        } catch (error) {
                            console.error('ì¬ê³„ì‚° ì‹¤íŒ¨:', id, error);
                        }
                    }

                    alert(`${success}ê°œ í•­ëª©ì˜ ì ìˆ˜ê°€ ì¬ê³„ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    this.selectedRows = [];
                    this.selectAll = false;
                    this.loadData();
                    this.loadStats();
                },
                async bulkDelete() {
                    if (!confirm(`${this.selectedRows.length}ê°œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

                    let success = 0;
                    for (const id of this.selectedRows) {
                        try {
                            await axios.delete(`/api/data-management/collection-results/${id}`);
                            success++;
                        } catch (error) {
                            console.error('ì‚­ì œ ì‹¤íŒ¨:', id, error);
                        }
                    }

                    alert(`${success}ê°œ í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    this.selectedRows = [];
                    this.selectAll = false;
                    this.loadData();
                    this.loadStats();
                },
                async viewDetail(id) {
                    try {
                        const response = await axios.get(`/api/data-management/collection-results/${id}`);
                        if (response.data.success) {
                            this.detailData = response.data.data;
                            this.showDetailModal = true;
                        }
                    } catch (error) {
                        console.error('ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                        alert('ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                },
                formatBusinessHours(hours) {
                    if (typeof hours === 'string') return hours;
                    if (typeof hours === 'object') return JSON.stringify(hours);
                    return '-';
                },
                exportCSV() {
                    const headers = ['ì´ë¦„', 'ë¶„ë¥˜', 'ì£¼ì†Œ', 'ì „í™”ë²ˆí˜¸', 'í‰ì ', 'ë¦¬ë·°ìˆ˜', 'ì¸ê¸°ë„ì ìˆ˜', 'í‹°ì–´', 'ì¶œì²˜', 'ìƒíƒœ'];
                    const rows = this.filteredResults.map(item => [
                        item.name,
                        item.category || '',
                        item.address || '',
                        item.phone || '',
                        item.rating || '',
                        item.review_count || 0,
                        item.popularity_score,
                        item.popularity_tier,
                        item.source,
                        item.edit_status
                    ]);

                    let csv = headers.join(',') + '\n';
                    rows.forEach(row => {
                        csv += row.map(cell => `"${cell}"`).join(',') + '\n';
                    });

                    const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `collection-results-${new Date().toISOString().split('T')[0]}.csv`;
                    link.click();
                },
                getTierText(tier) {
                    const map = {
                        'top_rated': 'Top',
                        'popular': 'Popular',
                        'average': 'Average',
                        'new': 'New'
                    };
                    return map[tier] || tier;
                },
                getStatusText(status) {
                    const map = {
                        'pending': 'ëŒ€ê¸°ì¤‘',
                        'edited': 'í¸ì§‘ë¨',
                        'approved': 'ìŠ¹ì¸ë¨',
                        'rejected': 'ê±°ë¶€ë¨'
                    };
                    return map[status] || status;
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
